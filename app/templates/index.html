{% extends 'base.html' %}
{% block titulo %}Painel de Manutenção{% endblock %}

{% block conteudo %}
<h1>Painel de Manutenção</h1>
<p>Confira abaixo os veículos com revisões próximas do vencimento.</p>

<div class="tabela-scroll">
  <table class="tabela-index">
    <thead>
      <tr>
        <th>Placa</th>
        <th>Motorista</th>
        <th>Modelo</th>
        <th>KM Atual</th>
        <th>Próx. Preventiva</th>
        <th>Próx. Intermediária</th>
        <th>Próx. Diferencial</th>
        <th>Próx. Câmbio</th>
        <th>Próx. Calibragem</th>
        <th>Unidade</th>
      </tr>
    </thead>
    <tbody>
      {% for veiculo in veiculos %}
        <tr>
          <td>{{ veiculo.placa }}</td>
          <td>{{ veiculo.motorista }}</td>
          <td>{{ veiculo.modelo }}</td>
          <td>{{ veiculo.km_atual | format_km }}</td>

          <td class="{% if veiculo.km_para_preventiva is not none and veiculo.km_para_preventiva <= 5000 %}alerta{% endif %}">
            {{ veiculo.km_para_preventiva | format_km if veiculo.km_para_preventiva is not none else '-' }}
          </td>

          <td class="{% if veiculo.km_para_intermediaria is not none and veiculo.km_para_intermediaria <= 5000 %}alerta{% endif %}">
            {{ veiculo.km_para_intermediaria | format_km if veiculo.km_para_intermediaria is not none else '-' }}
          </td>

          <td class="{% if veiculo.km_para_diferencial is not none and veiculo.km_para_diferencial <= 5000 %}alerta{% endif %}">
            {{ veiculo.km_para_diferencial | format_km if veiculo.km_para_diferencial is not none else '-' }}
          </td>

          <td class="{% if veiculo.km_para_cambio is not none and veiculo.km_para_cambio <= 5000 %}alerta{% endif %}">
            {{ veiculo.km_para_cambio | format_km if veiculo.km_para_cambio is not none else '-' }}
          </td>

          <td class="{% if veiculo.data_proxima_calibragem and veiculo.data_proxima_calibragem <= current_date %}alerta{% endif %}">
            {{ veiculo.data_proxima_calibragem.strftime('%d/%m/%Y') if veiculo.data_proxima_calibragem else '-' }}
          </td>

          <td>{{ veiculo.unidade }}</td>
        </tr>
      {% else %}
        <tr><td colspan="10">Nenhum veículo com manutenção próxima.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
